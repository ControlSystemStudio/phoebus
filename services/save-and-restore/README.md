# Save and restore service

The save-and-restore service implements the MASAR (MAchine Save And Restore) service as a collection
of REST endpoints. These can be used by clients to manage save sets (aka configurations) and
snapshots, to compare snapshots and to restore settings from snapshots.

The service depends on the app-save-and-restore-model module. 

Data is persisted by a relational database engine. The service has been verified on Postgresql and Mysql.

# Build

Build the Phoebus product. The jar file generated by default in the target directory of the save and restore service module
is a self-contained Spring Boot executable. It includes Tomcat dependencies and should
hence not be deployed to an external web application server.

To convert the build artifact to a war file for
deployment to an application server, see https://spring.io/guides/gs/convert-jar-to-war/

# Run

Run the service like so:

java [options] -jar service-save-and-restore-<version>.jar

Where [options] may override default values for Elasticsearch host (localhost) and port (9200):

-Delasticsearch.network.host=[host]  
-Delasticsearch.http.port=[port]

# Features

* The service defines a set of data objects - nodes - arranged in a tree structure. Nodes in the tree are
folders, configurations (aka save sets) and snapshots.

* There is always a top level root node of type folder. This cannot be modified in any manner.

* Child nodes of folder nodes are folder or configuration nodes. Child nodes
of configuration nodes are only snapshot nodes. Snapshot nodes will not contain
child nodes as this would not serve any use case.

* Snapshot nodes are associated with snapshot data items (stored PV values) 
and that are not part of the tree structure.

* Each node can be associated with an arbitrary number of named tags, e.g.
a "golden" tag can be set on snapshot nodes.

* Each node has a created date and a last updated date, as well as a username
attribute. This should identify the user creating or updating a node.

* Nodes in the tree can be renamed or deleted. When a folder or configuration
node is deleted, its entire subtree is deleted unconditionally.

* A folder or configuration node can be moved to another parent node. All
child nodes of the moved node remain child nodes of the moved node.

* Snapshot nodes cannot be moved as they are associated with the configuration
defining the list of PVs in the snapshot.

* The service is built upon Spring Boot and depends on Elasticsearch for data persistence.

Missing features:

* Security in terms of authentication and authorization.
